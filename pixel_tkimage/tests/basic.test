# vim: ft=tcl foldmethod=marker foldmarker=<<<,>>> shiftwidth=4 ts=4

if {[lsearch [namespace children] ::tcltest] == -1} {
	package require tcltest 2.2.5
	namespace import ::tcltest::*
}


package require Tk
wm withdraw .

package require Pixel_tkimage

test basic-1.1 {Wrap a pmap in an image, explicit name} -body { #<<<
	set pmap	[pixel::pmap_new 100 100 0x0]
	image create pmap testimage -pmap $pmap
} -cleanup {
	if {[lsearch [image names] testimage] != -1} {
		image delete testimage
	}
	if {[info exists pmap]} {
		unset pmap
	}
} -result {testimage}
#>>>
test basic-1.2 {Wrap a pmap in an image, autogenerated name} -body { #<<<
	set pmap	[pixel::pmap_new 100 100 0x0]
	set img		[image create pmap -pmap $pmap]
} -cleanup {
	if {[info exists img]} {
		if {[lsearch [image names] $img] != -1} {
			image delete $img
		}
		unset img
	}
	if {[info exists pmap]} {
		unset pmap
	}
} -match regexp -result {^image[0-9]+$}
#>>>
test basic-1.3 {imageName pmap method} -body { #<<<
	set pmap	[pixel::pmap_new 100 100 0x0]
	set img		[image create pmap -pmap $pmap]
	pixel::pmap_info [$img pmap]
} -cleanup {
	if {[info exists img]} {
		if {[lsearch [image names] $img] != -1} {
			image delete $img
		}
		unset img
	}
	if {[info exists pmap]} {
		unset pmap
	}
} -result {100 100}
#>>>
test basic-1.4 {imageName do_frame method} -body { #<<<
	set pmap	[pixel::pmap_new 100 100 0x0]
	pixel::box $pmap 0 0 100 100 0xff000000 0
	set img		[image create pmap -pmap $pmap]
	pixel::box $pmap 10 10 80 80 0xffff0000 0
	$img do_frame
} -cleanup {
	if {[info exists img]} {
		if {[lsearch [image names] $img] != -1} {
			image delete $img
		}
		unset img
	}
	if {[info exists pmap]} {
		unset pmap
	}
} -result {}
#>>>
test basic-1.5 {pixel::tkimage::do_frame command} -body { #<<<
	set pmap	[pixel::pmap_new 100 100 0x0]
	pixel::box $pmap 0 0 100 100 0xff000000 0
	set img		[image create pmap -pmap $pmap]
	pixel::box $pmap 10 10 80 80 0xffff0000 0
	pixel::tkimage::do_frame $pmap
} -cleanup {
	if {[info exists img]} {
		if {[lsearch [image names] $img] != -1} {
			image delete $img
		}
		unset img
	}
	if {[info exists pmap]} {
		unset pmap
	}
} -result {}
#>>>

::tcltest::cleanupTests
return
